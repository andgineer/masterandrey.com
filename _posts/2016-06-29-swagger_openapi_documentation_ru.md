---
layout: post
ref: swagger_openapi_documentation_ru
title: "Swagger API документация"
categories: api, web, swagger
comments: true
locale: ru_RU
lang: ru
summary: ...Swagger API документация...
tags: [api, web, swagger]
---

Нам потребовалось одно моменто согласовать с заказчиком и реализовать более дюжины API.
Каждое всего из нескольких вызовов, но общий объем заставлвл задуматься о стандартизации этого процесса.

Мы попробовали использовать [swagger](http://swagger.io) (он же [OpenAPI](http://swagger.io/specification/)).
Впечатления получились неоднозначные.

1. Нам необходимо было использовать swagger в направлении от документации к коду. Возможно, в обратном направлении
swagger и хорош (по готовому коду создать описание), но генерировать из swagger-описания код на java у нас не получилось.

Мы попробовали все имеющиеся варианты, и поняли, что проще написать руками, чем чистить потом, что получается.

2. Поддержка XML в swagger очень условная. По крайней мере, когда мы попробовали сгенерировать по swagger-описанию
сервер python, чтобы написать эумлятор, мы обнаружили, что в этом сервере вообще нет работы с XML.

Мы на скорую руку что-то впилили (не в таком состоянии, чтобы закинуть это патчем в
[swagger codegen](http://swagger.io/swagger-codegen/)).

3. Сервер для Python генерится на [tornado](http://www.tornadoweb.org/en/stable/) +
[connexion](https://pypi.python.org/pypi/connexion).

Казалось бы, все ок.

Но я обнаружил, что торнадо при этом невозможно использовать в асинхронном режиме.
Что как бы очень печально для эмулятора - эмулируем, например, паузу, и привет, все соедиенения ждут эту паузу.

Задал [вопрос в connexion](https://waffle.io/zalando/connexion), и получил изумительный ответ
giving it more though we would need to actually do quite some changes in other parts of the Connexion code to
support Tornado async. For now the answer is "not possible". :/

И дело не только в режиме использования сервера.

Черт с ней, с паузой, допустим нам надо во время обработки вызова сделать асинхронно другой вызов, через
сгенерированный swagger codegen клиент. На python генерится код, который вроде поддерживает асинхронность.

Смотрим внутрь него и видим, что в асинхронном режиме единственное что он делает - стартует еще одну нитку.
Прекрасно, а если в нитке exception? Это никак не обрабатывается.

4. Жесткая формализация и верификация описания это все-таки большое благо.

Так что не смотря на все эти фейлы, используя swagger мы получили четкое орписание, многие ошибки в котором
обнаруживаются на фазе проверки swagger.

И из которого мы генерим код для эмуляторов и тестовых клиентов, что позволяет существенно экономить усилия на фазе
активного изменения API.

Но при этом инструмент настолько крив, что с удовольствием взяли бы что-то иное, но вот что?


