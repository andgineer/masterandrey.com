---
layout: post
lang: ru
ref: python_decorator_function_signature
title: "Декораторы Python и сохранение набора параметров декорированной функции"
comments: true
tags: [Python decorator]
redirect_from: "/posts/ru/python_decorator_function_signature.md/"
---

[Декоратор](https://docs.python.org/3/library/doctest.html) подменяет исходную функцию.
И при этом изменяет ее "сигнатуру" - набор параметров.
У новой функции уже будет тот набор параметров, что в возвращенной декоратором 
функции.

Порой, это может создать проблемы.
Например, если мы далее передаем эту фукнцию фреймворку swagger transmute,
который автоматически строит swagger описание нашего API, анализируя наши
обработчики запросов.
Этот фреймворк описывает в swagger параметры запросов исходя из
 параметров наших функций- обработчиков этих запросов.
 
Но если мы обернули с какой-то целью наш обработчик в например в такой декоратор:

{% highlight python %}
{% include src/decorator.py %}
{% endhighlight %} 

то фреймворк уже не увидит исходных параметров.
 
Он будет видеть только те, что в возвращаемой
декоратором функции (безликие `*args, **kwargs`).
И не построит нам корректного swagger-описания.

Как описано в
[PEP0362](https://www.python.org/dev/peps/pep-0362/#visualizing-callable-objects-signature)
в Python, начиная с 3.3, можно подменять сигнатуру функции с помощью 
атрибута `__signature__`:

{% highlight python %}
{% include src/decorator2.py %}
{% endhighlight %}

Если мы также хотим сохранить прочие параметры функции, то это можно сделать
еще проще с помощью функции `wraps` модуля `functools`:

{% highlight python %}
{% include src/decorator2.py %}
{% endhighlight %}

`Wraps` сохраняет целый набор атрибутов функции, в частности строку документации
(`__doc__`).
Что весьма немаловажно, как для автоматического создания документации,
так и для [doc-tests](https://docs.python.org/3/library/doctest.html) 
- преставьте, что иначе вы потеряете doc-тесты исходной функции.

Немного неудобно, что по умолчанию `__signature__` не добавляется ко всем 
функциям. Если бы это было так, то мы могли бы добавить указание для `wraps` 
копировать также и его - у `wraps` есть параметр, в котором можно указать, 
какие параметры исходной функции надо скопировать в декорированную. 

Но параметра `__signature__` у произвольно взятой функции нет, если только его 
туда уже ранее специально не добавили.
Поэтому нам и нужна отдельная строчка в декораторе для присвоения `__signature__`.
