---
layout: post
lang: ru
ref: raspberry-dac
title: "Интернет-приемник: Подключение аудио ЦАП к raspberry pi"
comments: true
tags: [raspberry pi, DAC, HAT, PCM5102]
---

Если вы хотите сделать интернет-приемник, то самый простой вариант - взять raspberry pi, подключить к ней
ЦАП (цифро-аналоговый преобразователь, на ангийском DAC) и нравящуюся вам акустику
с усилителем.
Ну и поставить то приложение, которое вам нравится ([volumio](https://volumio.org/),
rune audio, max2play etc).
Управлять им вы будете со своего телефона, т.е. на самом интернет-приемнике у вас не будет никаких
элементов управления и его можно, например, спрятать за фальш-потолок.

ЦАП нужен потому, что из разъема для наушников у raspberry pi звук вообще ниже любой критики,
тут речь не об аудиофилии, а просто чтобы уши не болели.

## Альтернативы I2S DAC
Вместо DAC можно использовать любой HDMI-Video/audio преобразователь (ищется на [aliexpress](https://www.aliexpress.com) по строке "hdmi rca". Это коробочка, куда втыкается
на вход HDMI и на выходе разъемы RCA "тюльпаны" - желтый видео и белый/красный аудио).
Вместе с нужным для него HDMI кабелем будет стоить примерно как и описываемые ниже I2S DAC,
так что тут скорее дело вкуса, что использовать.

Конечно, с точки зрения программы это совершенно иной способ вывода звука (не управление
ЦАП по I2S интерфейсу, а вывод звука на HDMI), но для вас это просто переключатель
в веб-интерфейсе volumio.
HDMI Video преобразователи это даже более сложное устройство, чем I2S DAC (там есть и аудио-
и видео-ЦАП). Но, видимо, поскольку объем их продаж выше, они стоят дешевле I2S DAC,
который к тому же считается чем-то премиальным, аудиофильским.

## Варианты I2S DAC PCM5102 на aliexpress
Искать эти платы на [aliexpress](https://www.aliexpress.com) проще по строке
"Raspberry Pi PCM5102".

Это отличная альтернатива [HiFiBerry](https://www.hifiberry.com/), стоящей $35.
Модели на aliexpress более чем в четыре
раза дешевле, а построены они ровно на одной и той же микросхеме.

| Вывод на RCA разъемы | Вывод на разъем для наушников |
| ![](/images/PCM5102-DAC-Decoder-I2S-Player.jpg) &nbsp;&nbsp;| ![](/images/Sound-Card-I2S-PCM5102.jpg) |


Китайцы на них пишут, что это raspberry pi HAT-платы, но это не совсем правда.
Они подключаются к HAT разъему raspberry pi но их нельзя просто вставить в него, как HiFiBerry.

В принципе, паяльник не обязателен, если речь о первом варианте платы и новых raspberry pi
(не zero, на которой разъем расширения не распаян) - тогда можно соединить штырьки разъемов
с помощью контактных проводов (если они у вас есть, конечно). Найти такие провода можно на
[aliexpress](https://www.aliexpress.com) по строке "wires female to female dupont" -
как правило, они цветные, на концах разъемчики (вам нужен вариант female - female).

## raspberry pi A/B
На самых-самых ранних raspberry pi нужные ЦАП контакты не выведены ни на какой разъем, но вообще
есть на плате и в интернете вы можете найти соответствующие схему. Вряд ли у вас такая модель,
поэтому ниже я о них не пишу.

Если у вас чуть более свежие raspbery pi первой модели но до "+" варианта, то нужные
для ЦАП контакты находятся на 8-контактном разъеме `P5`, размещенном пониже основного
26-контактный разъема расширения `P1`.

Обычно `P5` не распаян. Можете посмотреть видео, как его распаивать
[на сайте HiFiBerry](https://www.hifiberry.com/solder-the-p5-header-to-your-raspberry-pi-model-ab/).

Подробнее о `P5` можно прочитать
[Raspberry Pi P5 Header](http://www.raspberrypi-spy.co.uk/2012/09/raspberry-pi-p5-header/).

Обратите внимание, что разъем подразумевается к установке с обратной стороны платы (хотя в
видео про HiFiBerry его паяют с той же стороны, что и основной разъем расширения).
Поэтому четные-нечетные контакты в `P5` с противоположной стороны от того, как в основном
разъеме `P1`.
Проверить себя, можно померив напряжение - на контакте `P5-1` должно быть 5В, на контакте `P5-2`
3.3В (оба последних контакта `P5`, `P5-7` и `P5-8` - земля).

## Raspberry Pi A\+/B\+, Raspberry Pi 2, Raspberry Pi 3

На более новых raspberry pi первой модели (с "+"), а также на raspberry pi второй и
третьей моделей, все нужные контакты находятся на основном 40-контактном разъеме расширения.
Он теперь называется `J8` и состоит  из 26 контактов старого разъема `P1`, и новых контактов.

Строго говоря, того, что было на `P5` в `J8` нет, но программно обеспечивается совместимость,
поэтому можно подключать ЦАП на старых моделях к `P1` и `P5`, а на новых к `J8`.

![](/images/raspberry-pi-p5.png)

## Как подключить I2S DAC к Raspberry Pi

### Первый вариант ЦАП:

| **ЦАП** | **Pi A/B** &nbsp;| **Pi A\+/B\+, Pi2, Pi3** |
|-----|-----|-----|
| Vcc (+5В) | P5-1 | J8-2 |
| +3.3В (не используется, указан для контроля нумерации контактов) &nbsp; | P5-2 | J8-1 |
| BCK | P5-3 | J8-12 |
| LRCK | P5-4 | J8-35 |
| DATA | P5-6 | J8-40 |
| Gnd | P5-7 | J8-39 |


В описании ЦАП китаец пишет, что неверно обозначены BCK и DATA, но, наверно, это относится
к ранним модификациям платы - на моей крайний разъем обозначен BCK, и так его и надо подключать.

### Второй вариант ЦАП: 

К первому варианту добавляются контакты:

| **ЦАП** | **Pi A/B** &nbsp;| **Pi A\+/B\+, Pi2, Pi3** |
|-----|-----|-----|
| GND |	P1-6 | J8-6 |
| FLT (gnd) | P1-14 | J8-14 |
| DMP (gnd) | P5-8 | J8-20 |
| SCL	| P1-5 | J8-5 |
| FMT (gnd) | P1-18 | J8-18 |
| XMT (3.3В) &nbsp; | P1-1 | J8-1 |


Подробно разъемы для интересующихся расписаны на вики:
[RPi Low-level peripherals](http://elinux.org/RPi_Low-level_peripherals)

## Как настроить ЦАП в Volumio

* Откройте в веб-браузере интерфейс вашего volumio - если volumio у вас один, то открыть его можно по адресу [http://volumio.local](http://volumio.local)
* Нажмите на шестеренку справа вверху окна volumio
* Выберите пункт меню `Playback`
* Включите переключатель I2S DAC и в I2S driver выберите `Generic I2S DAC`
* Нажмите `Apply`
* Volumio предупредит, что нужна перезагрузка raspberry pi - разрешите перезагрузку
