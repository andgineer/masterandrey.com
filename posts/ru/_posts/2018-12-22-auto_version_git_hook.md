---
layout: post
lang: ru
ref: auto_version_git_hook
title: "Автоматическое добавление версии в исходники (не обязательно Python) - GIT hook"
comments: true
tags: [Python, Git, bash]
redirect_from: "/posts/ru/auto_version_git_hook/"
---

![](/images/git-secret-big.png){:.post-title}

## Задача

Удобно всегда знать точную версию приложения, с которым ты имеешь дело.

Когда речь о передаче приложения по цепочке разработки (в отдел тестирования,
на демо и продуктовую площадки) всегда есть точная версия. Но ее ставят руками
в том или ином виде (например, как `git tag` в ветке релизов).

Когда речь идет о внутреннем сервере разработке, или собранной вами для отладки
версии приложения, нереально не забывать каждый раз менять версию.

Чтобы версия проставлялась автоматически можно использовать `git hooks`.
Это скрипты, работающие локально на вашем компьютере. Они вызываются
из `git` при соотвествующих событиях, например, перед комитом.

Показанный ниже скрипт (назовите его
`git_hook_hook_pre_commit.sh`) сохраняет в файл дату и 
время последнего комита и добавляет этот файл в комит.

{% highlight bash %}
{% include src/git_hook_pre_commit.sh %}
{% endhighlight %}

Скрипт (назовите его `git_hook_hook_post_commit.sh`) 
добавляет этот файл в комит.

{% highlight bash %}
{% include src/git_hook_post_commit.sh %}
{% endhighlight %}

Предполагается, что файл с датой оказывается внутри ваших исходников и они 
могут им воспользоваться.

Ниже пример Python кода, считывающего эту версию из файла. 

Далее вы можете
использовать ее в вашем приложении, например, чтобы отображать в диалоге
`О программе` или возвращать в вызове API `/version`.

{% highlight python %}
{% include src/version.py %}
{% endhighlight %} 

Из соображений
безопасности эти скрипты (`git hooks`) никогда не установливаются 
автоматически при скачивании репозитория, их всегда надо устанавливать явно.

Ниже показан скрипт, устанавливающий показанные выше скрипты как
`pre-comit & post-commit git hooks`.

{% highlight bash %}
{% include src/git_hook_install.sh %}
{% endhighlight %}
