---
layout: post
lang: ru
ref: amazon_dash
title: "Умная wi-fi кнопка и Docker на Synology (Amazon Dash Button hack)"
comments: true
summary: ...hack для amazon button...
tags: [amazon dash button, python, docker, synology]
---

![](/images/amazon_dash.png)

## TL; DR;
[Инструкция по настройке](http://masterandrey.com/posts/ru/amazon_dash_install/)

## Общая идея

Вы приклеиваете эту кнопку на стену, и ее нажатия регистрируются в таблице или календаре google,
также можно настроить любое действие через сервис [IFTTT](https://ifttt.com).

Из таблицы google можете строить любые графики и все, на что у вас хватит фантазии.

Практика показывает, что это нравится детям и служит для них дополнительным мотиватором 
что-то регулярно делать (например, зарядку).

Да и взрослым во многих ситуациях гораздо проще нажать на аппаратную кнопку на стене,
чем доставать телефон, искать там нужное приложение, нажимать кнопку в нем.

## Решение 

Для решения этой задачи трудно найти более простое и дешевое решение, чем 
[кнопка от amazon](https://www.amazon.com/b/?ie=UTF8&node=10667898011).

Особенно, когда они на распродаже по $0.99. Обратите внимание, при распродажах этих кнопок amazon
не вешает объявление на главную страницу, как для других своих устройств. 
Я увидел объявление о распродаже, на которой купил свои кнопки, только когда уже зашел на 
страницу выбора кнопок с готовностью купить их по регулярной цене.

В общем, и с регулярной стоимостью этих кнопок в $5 трудно конкурировать.
На [aliexpress](https://www.aliexpress.com) вы можете купить ESP8266 за $2 или более комфортную
в использовании NodeMCU за $4, но добавьте к ним корпус, светодиод, кнопку, батарейку, вооружитесь
паяльником на несколько часов, напишите микропрограмму..

Единственная неприятность - вам нужна подписка Amazon Prime, как для покупки кнопки, так и для
ее активации. Первый месяц она дается бесплатно, далее стоит порядка $10 в месяц.

Для регистрации нажатий кнопки вам нужно постоянно работающее приложение, которое 
будет при нажатии кнопки выполнять нужные действия. Я упаковал свое [приложение](https://github.com/masterandrey/docker-amazon-dash-button/) в 
[контейнер Docker](https://hub.docker.com/r/masterandrey/amazon-dash/) 
и у себя использую его на дисковом массиве [Synology](https://www.synology.com). 

Вы можете поставить его на любой постоянно включенный компьютер, где есть 
[Docker](https://www.docker.com).

Обратите внимание, что если это macOS или Windows, docker работает в них в виртуальной машине и поэтому
приложение из контейнера не сможет прослушивать сеть и надо его запускать вне контейнера.

Чтобы использовать мое приложение **вне** docker, вам надо установить [python3](https://www.python.org/downloads/) 
и перечисленные в 
[pip.requirements.txt](https://github.com/masterandrey/docker-amazon-dash-button/blob/master/pip.requirements.txt)
библиотеки, а также и все необходимые для них системные зависимости (их довольно много и их описание
надо искать в описании каждой библиотеки).
Поэтому я и рекомендую вам использовать мой контейнер docker, который во-1х избавляет вас от необходимости это
делать, а во-вторых не заставляет ставить специфичные для моего приложения библиотеки в вашу систему
и разбираться с возможными при этом конфликтами.

## Подробнее о решении

Внутри кнопки от Amazon достаточно мощный процессор ARM Cortex, если бы был простой способ 
использовать его с wifi обвязкой кнопки, то нам вовсе не нужен бы был никакой сервер. Но пока не нашли 
возможности сделать с его помощью что-то более полезное, чем помигать светодиодом
(и даже этот трюк далеко не так просто сделать).

Поэтому, строго говоря, это не взлом Amazon Dash Button, мы ничего с кнопкой не делаем, 
мы используем ее без изменений, обнаруживаем ее попытки
выйти в сеть и, если их видим, то считаем что кнопка нажата.

Мое [приложение](https://github.com/masterandrey/docker-amazon-dash-button) для прослушивания траффика 
в локальной сети использует python библиотеку [scapy](https://github.com/phaethon/scapy).

В сети есть немало альтернативных вариантов взлома кнопки Amazon Dash Button, но я не смог найти удобной 
интеграции с Google Drive (Google Sheets и Google Calendar) и 
готового контейнера Docker для установки на Synology, поэтому написал все это сам.
Контейнер я собрал на базе минималистичного Alpine Linux, он имеет минимально возможный объем
и требует совсем немного ресурсов, практически не влияя на загрузку Synology.

С моим приложением кнопка Amazon может не просто фиксировать события но и интервалы (например, как долго 
ребенок делал упражнения).
Для этого ее надо нажимать в начале и в конце интервала.

Как настроить, описано в [Инструкции по настройке](http://masterandrey.com/posts/ru/amazon_dash_install/).
